import{u as j,B as k,I as B,F as I,a as i,b as N,M as q,v as D,h as E,c as b}from"./index.f4df8a65.js";import{by as v,bF as M,bx as y,bW as O,bV as L,bE as e,bR as g}from"./vendor.6788785e.js";import"./vant.1989d0ae.js";const R="_app_wrapper_hb49y_1",T="_icon_hb49y_7",A="_previewNote_hb49y_12",l={app_wrapper:R,icon:T,previewNote:A},P=u=>{const t=v(u);return{ref:t,on:()=>t.value=!0,off:()=>t.value=!1,toggle:()=>t.value=!t.value}},z=M({setup:(u,t)=>{var f;const _=j(),o=y({email:"",code:""}),s=y({email:[],code:[]}),c=v(),{ref:w,on:F,off:h}=P(!1),C=O(),p=L(),d=(f=p.query.preview)==null?void 0:f.toString();d==="yes"&&Object.assign(o,{email:"wangdanmeng98@163.com",code:"123456"});const S=async a=>{var r;if(a.preventDefault(),Object.assign(s,{email:[],code:[]}),Object.assign(s,D(o,[{key:"email",type:"required",message:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},{key:"email",type:"pattern",regex:/^.+@.+$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1"},{key:"code",type:"required",message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801"}])),!E(s)){const n=await b.post("/session",o,{_autoLoading:!0}).catch(m);localStorage.setItem("jwt",n.data.jwt);const x=(r=p.query.return_to)==null?void 0:r.toString();_.refreshMe(),C.push(x||"/")}},m=a=>{Object.assign(s,a.response.data.errors)},V=async()=>{var a;F(),await b.post("/validation_codes",{email:o.email},{_autoLoading:!0}).catch(m).finally(h),(a=c.value)==null||a.startCount()};return()=>e(q,null,{title:()=>"\u767B\u5F55",icon:()=>e(k,null,null),default:()=>e("div",{class:l.wrapper},[e("div",{class:l.app_wrapper},[e(B,{name:"logo",class:l.icon},null)]),e(I,{onSubmit:S},{default:()=>{var a,r;return[d==="yes"&&e("p",{class:l.previewNote},[g("\u4F53\u9A8C\u8D26\u53F7\uFF0C\u53EF\u76F4\u63A5\u767B\u5F55")]),e(i,{label:"\u90AE\u7BB1\u5730\u5740",type:"text",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF0C\u7136\u540E\u70B9\u51FB\u53D1\u9001\u9A8C\u8BC1\u7801",modelValue:o.email,"onUpdate:modelValue":n=>o.email=n,error:(a=s.email)==null?void 0:a[0]},null),e(i,{label:"\u9A8C\u8BC1\u7801",type:"validationCode",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",modelValue:o.code,"onUpdate:modelValue":n=>o.code=n,error:(r=s.code)==null?void 0:r[0],countFrom:60,ref:c,onClick:V,disabled:w.value},null),e(i,{style:{paddingTop:"16px"}},{default:()=>[e(N,{type:"submit"},{default:()=>[g("\u767B\u5F55")]})]})]}})])})}});export{z as default};
